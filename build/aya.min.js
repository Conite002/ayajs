!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s((t="undefined"!=typeof globalThis?globalThis:t||self).aya={})}(this,function(t){"use strict";var u={svg:{fill:"white"},form:{stroke:"black",fill:"white",strokeOpacity:"1",strokeWidth:"1.5pt",fillOpacity:"1"},box:{stroke:"black",strokeWidth:"1px",fill:"none",strokeDasharray:"4"},point:{fill:"black",strokeWidth:"1pt",radius:3},line:{fill:"black",ends:{left:{type:"lozenge",props:{x:0,y:0,width:10,height:10}},right:{type:"triangle",props:{x1:0,y1:0,x2:10,y2:5,x3:0,y3:10}}}},text:{fill:"blue",fillOpacity:"100",stroke:"black",strokeWidth:"0.5pt",strokeOpacity:100,strokeDasharray:10.5,strokeDashoffset:10.5},group:{fill:"blue"}},i={};class _{static add(t){i[t.uuid]=t}static find(t){return i[t]}static clear(t){delete i[t]}static getAllLinksByComponent(s){var e=[];return Object.keys(i).map(t=>{t=_.find(t);"link"!=t.type||s.uuid!=t.source.ref&&s.uuid!=t.destination.ref||e.push(t)}),e}}class p{static generate(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}}class c{constructor(t,s=0,e=0,i=5,h,n,r){this.ref=t,this.uuid=p.generate(),this.x=s,this.y=e,this.r=i,this.scale=1,this.events={},this.nativeEvent=n,this.config=r,this.c_svg="",this.svg=h,_.add(this)}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}setScale(t){this.scale=t}getScale(){return this.scale}draw(){this.c_svg=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.c_svg.setAttribute("cx",this.x),this.c_svg.setAttribute("cy",this.y),this.c_svg.setAttribute("r",this.config.point.radius*this.scale),this.c_svg.setAttribute("id",this.uuid),this.addEvent("mousedown",this.nativeEvent.mouseDownCb),this.svg.appendChild(this.c_svg)}removeFromDOM(){this.svg.removeChild(this.c_svg)}shift(t,s){this.x+=t,this.y+=s}redraw(){this.c_svg.setAttribute("cx",this.x),this.c_svg.setAttribute("cy",this.y)}}class s{addEvent(t,s){}deleteEvent(t){}addChild(t,s,e){}setOffsetX(t){}setOffsetY(t){}setScaleX(t){}setScaleY(t){}getOffsetX(){}getOffsetY(){}getScaleX(){}getScaleY(){}setRotateCenter(t,s){}setRotateAngle(t){}drawVertex(){}drawConnector(){}drawBox(){}draw(t){}removeFromDOM(){}redraw(){}shift(t,s){}resize(t,s,e){}optimalPath(t){}}class r extends s{constructor(t,s=0,e=0,i=5,h,n,r){super(),this.uuid=t,this.x=s,this.y=e,this.r=i,this.events={},this.nativeEvent=n,this.config=r,this.box="",this.c_svg="",this.svg=h,this.type="circle",this.scale=1,this.offsetX=0,this.offsetY=0,this.angle=0,this.children=[],this.c_points=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent)],this.vertex=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s,e){t.setOffsetX(this.x),t.setOffsetY(this.y),s(this,t),e(this,t),t.draw(),this.children.push({child:t,translate:s,rotate:e})}drawVertex(){0!=this.vertex.length&&(this.vertex[0].x=this.x+this.offsetX-this.r*this.scale,this.vertex[0].y=this.y+this.offsetY-this.r*this.scale,this.vertex[1].x=this.x+this.offsetX+this.r*this.scale,this.vertex[1].y=this.y+this.offsetY-this.r*this.scale,this.vertex[2].x=this.x+this.offsetX+this.r*this.scale,this.vertex[2].y=this.y+this.offsetY+this.r*this.scale,this.vertex[3].x=this.x+this.offsetX-this.r*this.scale,this.vertex[3].y=this.y+this.offsetY+this.r*this.scale)}drawConnector(){0!=this.c_points.length&&(this.c_points[0].x=this.x+this.offsetX,this.c_points[0].y=this.y+this.offsetY-this.r*this.scale,this.c_points[1].x=this.x+this.offsetX+this.r*this.scale,this.c_points[1].y=this.y+this.offsetY,this.c_points[2].x=this.x+this.offsetX,this.c_points[2].y=this.y+this.offsetY+this.r*this.scale,this.c_points[3].x=this.x+this.offsetX-this.r*this.scale,this.c_points[3].y=this.y+this.offsetY)}drawBox(){var t=`M ${this.vertex[0].x} ${this.vertex[0].y}
                  L ${this.c_points[0].x} ${this.c_points[0].y} 
                  L ${this.vertex[1].x}   ${this.vertex[1].y} 
                  L ${this.c_points[1].x} ${this.c_points[1].y}
                  L ${this.vertex[2].x}   ${this.vertex[2].y}
                  L ${this.c_points[2].x} ${this.c_points[2].y} 
                  L ${this.vertex[3].x}   ${this.vertex[3].y} 
                  L ${this.c_points[3].x} ${this.c_points[3].y} Z`;this.box.setAttribute("d",t)}draw(){var t="http://www.w3.org/2000/svg";this.box=document.createElementNS(t,"path"),this.c_svg=document.createElementNS(t,"circle"),this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("cx",this.x+this.offsetX),this.c_svg.setAttribute("cy",this.y+this.offsetY),this.c_svg.setAttribute("r",this.r*this.scale),this.c_svg.setAttribute("fill",this.config.form.fill),this.c_svg.setAttribute("stroke",this.config.form.stroke),this.c_svg.setAttribute("stroke-width",this.config.form.strokeWidth),this.box.setAttributeNS(null,"stroke",config.box.stroke),this.box.setAttributeNS(null,"stroke-width",config.box.strokeWidth),this.box.setAttributeNS(null,"fill",config.box.fill),this.box.setAttribute("stroke-dasharray",config.box.strokeDasharray),this.svg.appendChild(this.c_svg),this.svg.appendChild(this.box),this.drawVertex(),this.drawConnector(),this.drawBox(),this.c_points.map(t=>{t.draw()}),this.vertex.map(t=>{t.draw()}),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()}),this.addEvent("mousedown",this.nativeEvent.mouseDownCb)}removeFromDOM(){this.svg.removeChild(this.box),this.svg.removeChild(this.c_svg)}shift(t,s){this.x+=t,this.y+=s}redraw(){this.c_svg.setAttribute("cx",this.x+this.offsetX),this.c_svg.setAttribute("cy",this.y+this.offsetY),this.c_svg.setAttribute("r",this.r*this.scale),this.drawConnector(),this.drawVertex(),this.drawBox(),this.vertex.map(t=>{t.redraw()}),this.c_points.map(t=>{t.redraw()}),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}resize(t,s,e){0==t?this.r+=-s:1==t||2==t?this.r+=s:this.r-=s,this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScale(t){this.scale=t}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScale(){return this.scale}optimalPath(t){for(var s,e,i=(t.dest_y-t.y)/(t.dest_x-t.x),h=t.y-i*t.x,n=0;n<=3;n++)if(n%2==0?s=((e=this.vertex[n].y)-h)/i:e=i*(s=this.vertex[n].x)+h,!(s==t.x&&e==t.y||s==t.dest_x&&e==t.dest_y)&&(0==n&&s>this.vertex[n].x&&s<this.vertex[n+1].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||1==n&&e>this.vertex[n].y&&e<this.vertex[n+1].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||2==n&&s>this.vertex[n+1].x&&s<this.vertex[n].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||3==n&&e>=this.vertex[0].y&&e<=this.vertex[n].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))))return this.c_points[n];return null}}class a extends s{constructor(t,s=0,e=0,i=10,h=10,n,r,a){super(),this.uuid=t,this.x=s,this.y=e,this.width=i,this.height=h,this.events={},this.nativeEvent=r,this.config=a,this.c_svg="",this.svg=n,this.type="rectangle",this.children=[],this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.angle=0,this.centerX=0,this.centerY=0,this.c_points=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new c(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new c(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new c(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)],this.vertex=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new c(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new c(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new c(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s,e){t.setOffsetX(this.x),t.setOffsetY(this.y),s(this,t),e(this,t),t.draw(),this.children.push({child:t,translate:s,rotate:e})}draw(){this.c_svg=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.c_svg.setAttributeNS(null,"x",this.x+this.offsetX),this.c_svg.setAttributeNS(null,"y",this.y+this.offsetY),this.c_svg.setAttributeNS(null,"id",this.uuid),this.c_svg.setAttributeNS(null,"height",this.height*this.scaleY),this.c_svg.setAttributeNS(null,"width",this.width*this.scaleX),this.c_svg.setAttributeNS(null,"stroke",this.config.form.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.form.strokeWidth),this.c_svg.setAttributeNS(null,"fill",this.config.form.fill),this.svg.appendChild(this.c_svg),this.drawConnector(),this.drawVertex(),this.c_points.map(t=>{t.draw()}),this.vertex.map(t=>{t.draw()}),this.addEvent("mousedown",this.nativeEvent.mouseDownCb),this.addEvent("mouseup",this.nativeEvent.mouseUpCb),this.addEvent("mouseover",this.nativeEvent.mouseMoveCb)}removeFromDOM(){this.svg.removeChild(this.c_svg)}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScaleX(t){this.scaleX=t}setScaleY(t){this.scaleY=t}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScaleX(){return this.scaleX}getScaleY(){return this.scaleY}getWidth(){return this.width}getHeight(){return this.height}drawVertex(){0!=this.vertex.length&&(this.vertex[0].x=this.x+this.offsetX,this.vertex[0].y=this.y+this.offsetY,this.vertex[1].x=this.x+this.offsetX+this.width*this.scaleX,this.vertex[1].y=this.y+this.offsetY,this.vertex[2].x=this.x+this.offsetX+this.width*this.scaleX,this.vertex[2].y=this.y+this.offsetY+this.height*this.scaleY,this.vertex[3].x=this.x+this.offsetX,this.vertex[3].y=this.y+this.offsetY+this.height*this.scaleY)}drawConnector(){0!=this.c_points.length&&(this.c_points[0].x=this.x+this.offsetX+this.width/2*this.scaleX,this.c_points[0].y=this.y+this.offsetY,this.c_points[1].x=this.x+this.offsetX+this.width*this.scaleX,this.c_points[1].y=this.y+this.offsetY+this.height/2*this.scaleY,this.c_points[2].x=this.x+this.offsetX+this.width/2*this.scaleX,this.c_points[2].y=this.y+this.offsetY+this.height*this.scaleY,this.c_points[3].x=this.x+this.offsetX,this.c_points[3].y=this.y+this.offsetY+this.height/2*this.scaleY)}shift(s,e){this.x+=s,this.y+=e,this.c_points.map(t=>{t.shift(s,e)}),this.vertex.map(t=>{t.shift(s,e)})}redraw(){this.c_svg.setAttributeNS(null,"x",this.x+this.offsetX),this.c_svg.setAttributeNS(null,"y",this.y+this.offsetY),this.c_svg.setAttributeNS(null,"height",this.height*this.scaleY),this.c_svg.setAttributeNS(null,"width",this.width*this.scaleX),this.drawVertex(),this.drawConnector(),this.c_points.map(t=>{t.redraw()}),this.vertex.map(t=>{t.redraw()}),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}resize(t,s,e){0==t?(this.shift(s,e),this.width+=-s,this.height+=-e):1==t?(this.y+=e,this.width+=s,this.height+=-e):2==t?(this.width+=s,this.height+=e):3==t&&(this.x+=s,this.width+=-s,this.height+=e),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}optimalPath(t){for(var s,e,i=(t.dest_y-t.y)/(t.dest_x-t.x),h=t.y-i*t.x,n=0;n<=3;n++)if(n%2==0?s=((e=this.vertex[n].y)-h)/i:e=i*(s=this.vertex[n].x)+h,!(s==t.x&&e==t.y||s==t.dest_x&&e==t.dest_y)&&(0==n&&s>this.vertex[n].x&&s<this.vertex[n+1].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||1==n&&e>this.vertex[n].y&&e<this.vertex[n+1].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||2==n&&s>this.vertex[n+1].x&&s<this.vertex[n].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||3==n&&e>=this.vertex[0].y&&e<=this.vertex[n].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))))return this.c_points[n];return null}}class w extends s{constructor(t,s=0,e=0,i=s,h=e,n,r,a){super(),this.uuid=t,this.x=s,this.y=e,this.dest_x=i,this.dest_y=h,this.pente=(this.dest_y-this.y)/(this.dest_x-this.x),this.events={},this.nativeEvent=r,this.config=a,this.c_svg="",this.svg=n,this.type="line",this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.angle=0,this.children=[],this.vertex=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new c(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)],this.c_points=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new c(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s,e){t.vertex=[],t.c_points=[],t.setOffsetX(this.x),t.setOffsetY(this.y),s(this,t),e(this,t),t.draw(),this.children.push({child:t,translate:s,rotate:e})}drawVertex(){0!=this.vertex.length&&(this.vertex[0].x=this.x+this.offsetX,this.vertex[0].y=this.y+this.offsetY,this.vertex[1].x=(this.dest_x+this.offsetX)*this.scaleX,this.vertex[1].y=(this.dest_y+this.offsetY)*this.scaleY)}drawConnector(){}drawBox(){}draw(){this.c_svg=document.createElementNS("http://www.w3.org/2000/svg","path");var t="M "+(this.x+this.offsetX)+","+(this.y+this.offsetY)+" "+(this.dest_x+this.offsetX)*this.scaleX+","+(this.dest_y+this.offsetY)*this.scaleY;this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("d",t),this.c_svg.setAttribute("fill",this.config.form.fill),this.c_svg.setAttribute("stroke",this.config.form.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.form.strokeWidth),this.svg.appendChild(this.c_svg),this.drawVertex(),this.c_points.map(t=>{t.draw()}),this.vertex.map(t=>{t.draw()}),this.addEvent("mousedown",this.nativeEvent.mouseDownCb)}removeFromDOM(){this.svg.removeChild(this.c_svg)}shift(t,s){this.x+=t,this.y+=s,this.dest_x+=t,this.dest_y+=s}redraw(){this.drawVertex(),this.vertex.map(t=>{t.redraw()});var t="M "+(this.x+this.offsetX)+","+(this.y+this.offsetY)+" "+(this.dest_x+this.offsetX)*this.scaleX+","+(this.dest_y+this.offsetY)*this.scaleY;this.c_svg.setAttribute("d",t),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}calculateAngle(){var t;return this.pente=(this.dest_y-this.y)/(this.dest_x-this.x),0==this.pente&&(t=0),0<=this.pente&&this.x<this.dest_x&&this.y<this.dest_y?t=Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.y-this.dest_y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):0<=this.pente&&this.x>this.dest_x&&this.y>this.dest_y?t=Math.PI+Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):this.pente<=0&&this.x<this.dest_x&&this.y>this.dest_y?t=2*Math.PI-Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):this.pente<=0&&this.x>this.dest_x&&this.y<this.dest_y&&(t=Math.PI-Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2)))),t}resize(t,s,e){0==t?(this.x+=s,this.y+=e):(this.dest_x+=s,this.dest_y+=e),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),t.setRotateAngle(this.calculateAngle()+90*Math.PI/180),e(this,t),t.redraw()})}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScaleX(t){this.scaleX=t}setScaleY(t){this.scaleY=t}getRotateAngle(){return this.angle}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScaleX(){return this.scaleX}getScaleY(){return this.scaleY}optimalPath(){}}class o extends s{constructor(t,s=0,e=0,i=5,h=5,n=10,r=10,a,o,d){super(),this.uuid=t,this.x1=s,this.y1=e,this.x2=i,this.y2=h,this.x3=n,this.y3=r,this.events={},this.nativeEvent=o,this.config=d,this.c_svg="",this.svg=a,this.type="triangle",this.children=[],this.offsetX=0,this.offsetY=0,this.scaleX=0,this.scaleY=0,this.angle=0,this.centerX=0,this.centerY=0,this.c_points=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent)],this.vertex=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s,e){}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScaleX(t){this.scaleX=t}setScaleY(t){this.scaleY=t}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScaleX(){return this.scaleX}getScaleY(){return this.scaleY}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}drawVertex(){this.vertex.length}drawConnector(){this.c_points.length}drawBox(){}draw(){var t,s,e,i,h,n,r,a;this.c_svg=document.createElementNS("http://www.w3.org/2000/svg","path"),0!=this.angle?(t=this.x1*Math.cos(this.angle)-this.y1*Math.sin(this.angle),s=this.x1*Math.sin(this.angle)+this.y1*Math.cos(this.angle),e=this.x2*Math.cos(this.angle)-this.y2*Math.sin(this.angle),i=this.x2*Math.sin(this.angle)+this.y2*Math.cos(this.angle),h=this.x3*Math.cos(this.angle)-this.y3*Math.sin(this.angle),n=this.x3*Math.sin(this.angle)+this.y3*Math.cos(this.angle),r=this.centerX*Math.cos(this.angle)-this.centerY*Math.sin(this.angle),a=this.centerX*Math.sin(this.angle)+this.centerY*Math.cos(this.angle),r=r-this.centerX,a=a-this.centerY,this.p="M "+(t-r+this.offsetX)+","+(s-a+this.offsetY)+" L "+(e-r+this.offsetX)+","+(i-a+this.offsetY)+" L "+(h-r+this.offsetX)+","+(n-a+this.offsetY)+" Z"):this.p="M "+(this.x1+this.offsetX)+","+(this.y1+this.offsetY)+" L "+(this.x2+this.offsetX)+","+(this.y2+this.offsetY)+" L "+(this.x3+this.offsetX)+","+(this.y3+this.offsetY)+" Z",this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("d",this.p),this.c_svg.setAttributeNS(null,"stroke",this.config.form.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.form.strokeWidth),this.c_svg.setAttribute("fill",this.config.form.fill),this.svg.appendChild(this.c_svg),this.addEvent("mousedown",this.nativeEvent.mouseDownCb),this.addEvent("mouseup",this.nativeEvent.mouseUpCb)}removeFromDOM(){this.svg.removeChild(this.c_svg)}shift(s,e){this.x1+=s,this.y1+=e,this.x2+=s,this.y2+=e,this.x3+=s,this.y3+=e,this.c_points.map(t=>{t.shift(s,e)}),this.vertex.map(t=>{t.shift(s,e)})}redraw(){var t,s,e,i,h,n,r,a;0!=this.angle?(t=this.x1*Math.cos(this.angle)-this.y1*Math.sin(this.angle),s=this.x1*Math.sin(this.angle)+this.y1*Math.cos(this.angle),e=this.x2*Math.cos(this.angle)-this.y2*Math.sin(this.angle),i=this.x2*Math.sin(this.angle)+this.y2*Math.cos(this.angle),h=this.x3*Math.cos(this.angle)-this.y3*Math.sin(this.angle),n=this.x3*Math.sin(this.angle)+this.y3*Math.cos(this.angle),r=this.centerX*Math.cos(this.angle)-this.centerY*Math.sin(this.angle),a=this.centerX*Math.sin(this.angle)+this.centerY*Math.cos(this.angle),r=r-this.centerX,a=a-this.centerY,this.p="M "+(t-r+this.offsetX)+","+(s-a+this.offsetY)+" L "+(e-r+this.offsetX)+","+(i-a+this.offsetY)+" L "+(h-r+this.offsetX)+","+(n-a+this.offsetY)+" Z"):this.p="M "+(this.x1+this.offsetX)+","+(this.y1+this.offsetY)+" L "+(this.x2+this.offsetX)+","+(this.y2+this.offsetY)+" L "+(this.x3+this.offsetX)+","+(this.y3+this.offsetY)+" Z",this.c_svg.setAttribute("d",this.p)}resize(t,s,e){0==t?(this.x1=s,this.y1=e,this.vertex[0].x=s,this.vertex[0].y=e):1==t?(this.x2=s,this.y2=e,this.vertex[1].x=s,this.vertex[1].y=e):2==t&&(this.x3=s,this.y3=e,this.vertex[2].x=s,this.vertex[2].y=e)}optimalPath(t){for(var s,e,i=(t.dest_y-t.y)/(t.dest_x-t.x),h=t.y-i*t.x,n=0;n<=3;n++)if(n%2==0?s=((e=this.vertex[n].y)-h)/i:e=i*(s=this.vertex[n].x)+h,!(s==t.x&&e==t.y||s==t.dest_x&&e==t.dest_y)&&(0==n&&s>this.vertex[n].x&&s<this.vertex[n+1].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||1==n&&e>this.vertex[n].y&&e<this.vertex[n+1].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||2==n&&s>this.vertex[n+1].x&&s<this.vertex[n].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||3==n&&e>=this.vertex[0].y&&e<=this.vertex[n].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))))return this.c_points[n];return null}}class d extends s{constructor(t,s=0,e=0,i=10,h=30,n,r,a){super(),this.uuid=t,this.x=s,this.y=e,this.width=i,this.height=h,this.events={},this.nativeEvent=r,this.config=a,this.c_svg="",this.svg=n,this.box="",this.type="lozenge",this.p="",this.scaleX=1,this.scaleY=1,this.offsetX=0,this.offsetY=0,this.angle=0,this.centerX=0,this.centerY=0,this.children=[],this.c_points=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent)],this.vertex=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s,e){t.setOffsetX(this.x),t.setOffsetY(this.y),s(this,t),e(this,t),t.draw(),this.children.push({child:t,translate:s,rotate:e})}drawVertex(){0!=this.vertex.length&&(this.vertex[0].x=this.x+this.offsetX-this.width/2*this.scaleX,this.vertex[0].y=this.y+this.offsetY,this.vertex[1].x=this.x+this.offsetX+this.width/2*this.scaleX,this.vertex[1].y=this.y+this.offsetY,this.vertex[2].x=this.x+this.offsetX+this.width/2*this.scaleX,this.vertex[2].y=this.y+this.offsetY+this.height*this.scaleY,this.vertex[3].x=this.x+this.offsetX-this.width/2*this.scaleX,this.vertex[3].y=this.y+this.offsetY+this.height*this.scaleY)}drawConnector(){0!=this.c_points.length&&(this.c_points[0].x=this.x+this.offsetX,this.c_points[0].y=this.y+this.offsetY,this.c_points[1].x=this.x+this.offsetX+this.width/2*this.scaleX,this.c_points[1].y=this.y+this.offsetY+this.height/2*this.scaleY,this.c_points[2].x=this.x+this.offsetX,this.c_points[2].y=this.y+this.offsetY+this.height*this.scaleY,this.c_points[3].x=this.x+this.offsetX-this.width/2*this.scaleX,this.c_points[3].y=this.y+this.offsetY+this.height/2*this.scaleY)}draw(){var t,s,e,i="http://www.w3.org/2000/svg";this.c_svg=document.createElementNS(i,"path"),this.box=document.createElementNS(i,"path"),0!=this.angle?(i=this.x*Math.cos(this.angle)-this.y*Math.sin(this.angle),t=this.x*Math.sin(this.angle)+this.y*Math.cos(this.angle),s=this.centerX*Math.cos(this.angle)-this.centerY*Math.sin(this.angle),e=this.centerX*Math.sin(this.angle)+this.centerY*Math.cos(this.angle),s=s-this.centerX,e=e-this.centerY,this.p=`M ${i-s+this.offsetX} ${t-e+this.offsetY}  L ${i-s+this.offsetX+this.width/2*this.scaleX} ${t-e+this.offsetY+this.height/2*this.scaleY}  L ${i-s+this.offsetX} ${t-e+this.offsetY+this.height*this.scaleY}  L ${i-s+this.offsetX-this.width/2*this.scaleX} ${t-e+this.offsetY+this.height/2*this.scaleY}Z`):this.p=`M ${this.x+this.offsetX} ${this.y+this.offsetY}  L ${this.x+this.offsetX+this.width/2*this.scaleX} ${this.y+this.offsetY+this.height/2*this.scaleY}  L ${this.x+this.offsetX} ${this.y+this.offsetY+this.height*this.scaleY}  L ${this.x+this.offsetX-this.width/2*this.scaleX} ${this.y+this.offsetY+this.height/2*this.scaleY}Z`,this.drawVertex(),this.drawConnector(),this.drawBox(),this.c_svg.setAttribute("d",this.p),this.vertex.map(t=>{t.draw()}),this.c_points.map(t=>{t.draw()}),this.box.setAttribute("id",this.uuid),this.box.setAttributeNS(null,"stroke",this.config.box.stroke),this.box.setAttributeNS(null,"stroke-width",this.config.box.strokeWidth),this.box.setAttributeNS(null,"fill",this.config.box.fill),this.box.setAttribute("stroke-dasharray",this.config.box.strokeDasharray),this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("d",this.p),this.c_svg.setAttributeNS(null,"stroke",this.config.form.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.form.strokeWidth),this.c_svg.setAttribute("fill",this.config.form.fill),this.svg.appendChild(this.c_svg),this.svg.appendChild(this.box),this.addEvent("mousedown",this.nativeEvent.mouseDownCb),this.addEvent("mouseup",this.nativeEvent.mouseUpCb)}removeFromDOM(){this.svg.removeChild(this.box),this.svg.removeChild(this.c_svg)}redraw(){var t,s,e,i;0!=this.angle?(t=this.x*Math.cos(this.angle)-this.y*Math.sin(this.angle),s=this.x*Math.sin(this.angle)+this.y*Math.cos(this.angle),e=this.centerX*Math.cos(this.angle)-this.centerY*Math.sin(this.angle),i=this.centerX*Math.sin(this.angle)+this.centerY*Math.cos(this.angle),e=e-this.centerX,i=i-this.centerY,this.p=`M ${t-e+this.offsetX} ${s-i+this.offsetY}  L ${t-e+this.offsetX+this.width/2*this.scaleX} ${s-i+this.offsetY+this.height/2*this.scaleY}  L ${t-e+this.offsetX} ${s-i+this.offsetY+this.height*this.scaleY}  L ${t-e+this.offsetX-this.width/2*this.scaleX} ${s-i+this.offsetY+this.height/2*this.scaleY}Z`):this.p=`M ${this.x+this.offsetX} ${this.y+this.offsetY}  L ${this.x+this.offsetX+this.width/2*this.scaleX} ${this.y+this.offsetY+this.height/2*this.scaleY}  L ${this.x+this.offsetX} ${this.y+this.offsetY+this.height*this.scaleY}  L ${this.x+this.offsetX-this.width/2*this.scaleX} ${this.y+this.offsetY+this.height/2*this.scaleY}Z`,this.drawVertex(),this.drawConnector(),this.drawBox(),this.c_svg.setAttribute("d",this.p),this.vertex.map(t=>{t.redraw()}),this.c_points.map(t=>{t.redraw()}),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}resize(t,s,e){0==t?(this.shift(s,e),this.width+=-s,this.height+=-e):1==t?(this.y+=e,this.width+=s,this.height+=-e):2==t?(this.width+=s,this.height+=e):3==t&&(this.x+=s,this.width+=-s,this.height+=e),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}drawBox(){var t;0!=this.c_points.length&&0!=this.vertex.length&&(t=`M ${this.vertex[0].x} ${this.vertex[0].y}
              L ${this.c_points[0].x} ${this.c_points[0].y} 
              L ${this.vertex[1].x}   ${this.vertex[1].y} 
              L ${this.c_points[1].x} ${this.c_points[1].y}
              L ${this.vertex[2].x}   ${this.vertex[2].y}
              L ${this.c_points[2].x} ${this.c_points[2].y} 
              L ${this.vertex[3].x}   ${this.vertex[3].y} 
              L ${this.c_points[3].x} ${this.c_points[3].y} Z`,this.box.setAttribute("d",t))}shift(s,e){this.x+=s,this.y+=e,this.c_points.map(t=>{t.shift(s,e)}),this.vertex.map(t=>{t.shift(s,e)})}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScaleX(t){this.scaleX=t}setScaleY(t){this.scaleY=t}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScaleX(){return this.scaleX}getScaleY(){return this.scaleY}optimalPath(t){for(var s,e,i=(t.dest_y-t.y)/(t.dest_x-t.x),h=t.y-i*t.x,n=0;n<=3;n++)if(n%2==0?s=((e=this.vertex[n].y)-h)/i:e=i*(s=this.vertex[n].x)+h,!(s==t.x&&e==t.y||s==t.dest_x&&e==t.dest_y)&&(0==n&&s>this.vertex[n].x&&s<this.vertex[n+1].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||1==n&&e>this.vertex[n].y&&e<this.vertex[n+1].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||2==n&&s>this.vertex[n+1].x&&s<this.vertex[n].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||3==n&&e>=this.vertex[0].y&&e<=this.vertex[n].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))))return this.c_points[n];return null}}class f extends s{constructor(t,s=[],e,i,h){super(),this.uuid=t,this.x=s[0],this.y=s[1],this.dest_x=s[s.length-2],this.dest_y=s[s.length-1],this.points=s,this.events={},this.nativeEvent=i,this.config=h,this.c_svg="",this.svg=e,this.type="polyline",this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.angle=0,this.children=[],this.vertex=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent)],this.c_points=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s,e){t.vertex=[],t.c_points=[],t.setOffsetX(this.x),t.setOffsetY(this.y),s(this,t),e(this,t),t.draw(),this.children.push({child:t,translate:s,rotate:e})}drawVertex(){this.vertex.length}drawConnector(){}drawBox(){}draw(){this.c_svg=document.createElementNS("http://www.w3.org/2000/svg","polyline");for(var t="",s=0;s<this.points.length;s++)t+=s%2==0?this.points[s]+",":this.points[s]+" ";this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("fill",this.config.form.fill),this.c_svg.setAttribute("stroke",this.config.form.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.form.strokeWidth),this.c_svg.setAttribute("points",t),svg.appendChild(this.c_svg),this.drawVertex(),this.c_points.map(t=>{t.draw()}),this.vertex.map(t=>{t.draw()}),this.addEvent("mousedown",this.nativeEvent.mouseDownCb)}removeFromDOM(){this.svg.removeChild(this.c_svg)}shift(t,s){}redraw(){this.drawVertex(),this.vertex.map(t=>{t.redraw()});var t=this.points.map((t,s)=>{})+" ";this.c_svg.setAttribute("point",t),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}calculateAngle(){var t;return this.pente=(this.dest_y-this.y)/(this.dest_x-this.x),0==this.pente&&(t=0),0<=this.pente&&this.x<this.dest_x&&this.y<this.dest_y?t=Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.y-this.dest_y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):0<=this.pente&&this.x>this.dest_x&&this.y>this.dest_y?t=Math.PI+Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):this.pente<=0&&this.x<this.dest_x&&this.y>this.dest_y?t=2*Math.PI-Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):this.pente<=0&&this.x>this.dest_x&&this.y<this.dest_y&&(t=Math.PI-Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2)))),t}resize(t,s,e){0==t?(this.x+=s,this.y+=e):(this.dest_x+=s,this.dest_y+=e),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),t.setRotateAngle(this.calculateAngle()+90*Math.PI/180),e(this,t),t.redraw()})}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScaleX(t){this.scaleX=t}setScaleY(t){this.scaleY=t}getRotateAngle(){return this.angle}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScaleX(){return this.scaleX}getScaleY(){return this.scaleY}optimalPath(){}}class v extends s{constructor(t,s=0,e=0,i=100,h=100,n=90,r,a,o){super(),this.uuid=t,this.x0=s,this.y0=e,this.x=i,this.y=h,this.angle=n,this.dest_x=Math.round(this.x0+(this.x-this.x0)*Math.cos(this.angle*Math.PI/180)+(this.y-this.y0)*Math.sin(this.angle*Math.PI/180)),this.dest_y=Math.round(this.y0-(this.x-this.x0)*Math.sin(this.angle*Math.PI/180)+(this.y-this.y0)*Math.cos(this.angle*Math.PI/180)),this.events={},this.nativeEvent=a,this.config=o,this.c_svg="",this.svg=r,this.type="arc",this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.radius=Math.sqrt((this.x-this.x0)*(this.x-this.x0)+(this.y-this.y0)*(this.y-this.y0)),this.children=[],this.vertex=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent)],this.c_points=[new c(this.uuid,0,0,5,this.svg,this.nativeEvent),new c(this.uuid,0,0,5,this.svg,this.nativeEvent)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s,e){t.vertex=[],t.c_points=[],t.setOffsetX(this.x),t.setOffsetY(this.y),s(this,t),e(this,t),t.draw(),this.children.push({child:t,translate:s,rotate:e})}drawVertex(){this.vertex.length}drawConnector(){this.c_points.length}drawBox(){}draw(){this.c_svg=document.createElementNS("http://www.w3.org/2000/svg","path"),this.p="M "+this.x+" "+this.y+" A "+this.radius+" "+this.radius+" 0 "+(180<this.angle?1:0)+" 0 "+this.dest_x+" "+this.dest_y,this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("fill",this.config.form.fill),this.c_svg.setAttribute("stroke",this.config.form.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.form.strokeWidth),this.c_svg.setAttribute("d",this.p),this.svg.appendChild(this.c_svg),this.drawVertex(),this.drawConnector(),this.c_points.map(t=>{t.draw()}),this.vertex.map(t=>{t.draw()}),this.addEvent("mousedown",this.nativeEvent.mouseDownCb)}removeFromDOM(){this.svg.removeChild(this.c_svg)}shift(t,s){this.x0+=t,this.y0+=s,this.x+=t,this.y+=s}redraw(){this.drawVertex(),this.vertex.map(t=>{t.redraw()}),this.p="M "+this.x+" "+this.y+" A "+this.radius+" "+this.radius+" 0 "+(180<this.angle?1:0)+" 0 "+this.dest_x+" "+this.dest_y,this.c_svg.setAttribute("d",this.p),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}calculateAngle(){var t;return this.pente=(this.dest_y-this.y)/(this.dest_x-this.x),0==this.pente&&(t=0),0<=this.pente&&this.x<this.dest_x&&this.y<this.dest_y?t=Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.y-this.dest_y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):0<=this.pente&&this.x>this.dest_x&&this.y>this.dest_y?t=Math.PI+Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):this.pente<=0&&this.x<this.dest_x&&this.y>this.dest_y?t=2*Math.PI-Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):this.pente<=0&&this.x>this.dest_x&&this.y<this.dest_y&&(t=Math.PI-Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2)))),t}resize(t,s,e){0==t?(this.x+=s,this.y+=e):(this.dest_x+=s,this.dest_y+=e),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),t.setRotateAngle(this.calculateAngle()+90*Math.PI/180),e(this,t),t.redraw()})}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScaleX(t){this.scaleX=t}setScaleY(t){this.scaleY=t}getRotateAngle(){return this.angle}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScaleX(){return this.scaleX}getScaleY(){return this.scaleY}optimalPath(){}}class e{constructor(t,s,e,i,h){this.uuid=p.generate(),this.type=t,this.form=class{static createForm(t,s,e={},i,h,n){return"circle"==s?new r(t,e.x,e.y,e.r,i,h,n):"rectangle"==s?new a(t,e.x,e.y,e.width,e.height,i,h,n):"line"==s?new w(t,e.x,e.y,e.dest_x,e.dest_y,i,h,n):"triangle"==s?new o(t,e.x1,e.y1,e.x2,e.y2,e.x3,e.y3,i,h,n):"lozenge"==s?new d(t,e.x,e.y,e.width,e.height,i,h,n):"polyline"==s?new f(t,e.points,i,h,n):"arc"==s?new v(t,e.x0,e.y0,e.x,e.y,e.angle,i,h,n):void 0}}.createForm(this.uuid,t,s,e,i,h),_.add(this),this.form.draw()}}class h{constructor(t,s=0,e=0,i="text",h,n,r){this.uuid=t,this.x=s,this.y=e,this.text=i,this.svg=h,this.nativeEvent=n,this.config=r,this.offsetX=0,this.offsetY=0,this.centerX=0,this.centerY=0,this.parentWidth=0,this.parentHeight=0,this.parentX=0,this.parentY=0,this.angle=0,this.tspan="",this.title=""}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}draw(){var t="http://www.w3.org/2000/svg";this.c_svg=document.createElementNS(t,"text"),this.c_svg.setAttributeNS(null,"x",this.x+this.offsetX),this.c_svg.setAttributeNS(null,"y",this.y+this.offsetY),this.c_svg.setAttributeNS(null,"id",this.uuid),this.c_svg.setAttributeNS(null,"fill",this.config.text.fill),this.c_svg.setAttributeNS(null,"stroke",this.config.text.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.text.strokeWidth),this.c_svg.setAttributeNS(null,"fill-opacity",this.config.text.fillOpacity),this.c_svg.setAttributeNS(null,"stroke-dasharray",this.config.text.strokeDasharray),this.c_svg.setAttributeNS(null,"stroke-dashoffset",this.config.text.strokeDashoffset),this.tspan=document.createElementNS(t,"tspan"),this.title=document.createElementNS(t,"title"),this.c_svg.appendChild(this.tspan),this.c_svg.appendChild(this.title),this.updateWidthText(),this.svg.appendChild(this.c_svg)}updateWidthText(t=5){var s="",e=!1,i=this.parentWidth+this.parentX-this.offsetX,i=i<6*this.text.length?i/6:0;0==i?s=this.text.substring(t=0,this.text.length):(s=this.text.substring(0,i-t),e=!0),e&&(s=s.concat("...")),this.tspan.textContent=s,this.title.textContent=this.text}removeFromDom(){this.svg.removeChild(this.c_svg)}redraw(){this.c_svg.setAttributeNS(null,"x",this.x+this.offsetX),this.c_svg.setAttributeNS(null,"y",this.y+this.offsetY),this.updateWidthText()}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getParentWidth(){return this.parentWidth}setParentWidth(t){this.parentWidth=t}getParentHeight(){return this.parentHeight}setParentHeight(t){this.parentHeight=t}setParentX(t){this.parentX=t}setParentY(t){this.parentY=t}}class m{constructor(t,s,e=void 0){this.uuid=p.generate(),this.source=t,this.destination=s,this.line=e,this.type="link",_.add(this)}redraw(){var t=_.find(this.source.ref),s=_.find(this.destination.ref),t=t.form.optimalPath(this.line),s=s.form.optimalPath(this.line);t&&(this.source=t),s&&(this.destination=s),this.line.x=this.source.x,this.line.y=this.source.y,this.line.dest_x=this.destination.x,this.line.dest_y=this.destination.y,this.line.redraw()}}class n{constructor(t,s,e,i){this.uuid=t,this.events={},this.nativeEvent=e,this.config=i,this.c_svg="",this.svg=s,this.type="group",this.angle=0,this.centerX=0,this.centerY=0,this.c_svg="",this.children=[]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s,e){t.vertex=[],t.c_points=[],t.setOffsetX(this.x),t.setOffsetY(this.y),s(this,t),e(this,t),t.draw(),this.children.push({child:t,translate:s,rotate:e})}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}draw(){this.c_svg=document.createElementNS("http://www.w3.org/2000/svg","g"),this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("fill",this.config.group.fill),this.c_svg.setAttribute("stroke",this.config.form.stroke),this.svg.appendChild(this.c_svg),this.addEvent("mousedown",this.nativeEvent.mouseDownCb)}removeFromDOM(){this.svg.removeChild(this.c_svg)}shift(t,s){this.x+=t,this.y+=s}redraw(){}resize(t,s,e,i=0){}}t.Application=class{constructor(t=1e3,s=1e3){var e,i,h,n,r,a,o,d,c,f,v,l,x,g,y;this.uuid=p.generate(),this.svg_width=t,this.svg_height=s,this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this.svg_width),this.svg.setAttribute("height",this.svg_height),this.svg.setAttribute("id",this.uuid),this.config=u,this.events=(e=this.svg,i=this.uuid,h=this.events,t=this.config,g=x="",y=t,{mouseDownCb:function(t){a=t.offsetX,o=t.offsetY,n=t.srcElement.id,r=_.find(n),n!=i&&(f=null!=r&&null!=r.ref?_.find(r.ref):r),null!=r.form&&(v=_.getAllLinksByComponent(r)),null!=r&&null==r.ref?x="moving":null!=f.form.vertex&&0<=(l=f.form.vertex.indexOf(r))?(x="resizing",a=t.offsetX,o=t.offsetY,r=_.find(r.ref),v=_.getAllLinksByComponent(r)):(x="drawing_link",n=p.generate(),r!=f&&(g=new w(n,r.x,r.y,e,h,y)).draw())},mouseMoveCb:function(t){var e;"moving"==x?(d=t.offsetX-a,c=t.offsetY-o,a=t.offsetX,o=t.offsetY,null!=r.form&&(v.map(s=>{r.form.c_points.map(t=>{t==s.source?e=t:s.destination}),e?(s.line.x+=d,s.line.y+=c):(s.line.dest_x+=d,s.line.dest_y+=c),s.line.redraw()}),r.form.shift(d,c),r.form.redraw(),v.map(t=>{t.redraw()}))):"drawing_link"==x?(g.dest_x=t.clientX,g.dest_y=t.clientY,g.redraw()):"resizing"==x&&(d=t.offsetX-a,c=t.offsetY-o,a=t.offsetX,o=t.offsetY,f.form.resize(l,d,c),f.form.redraw(),v.map(t=>{t.redraw()}))},mouseUpCb:function(t){"drawing_link"==x&&(n=t.srcElement.id,null!=(t=_.find(n))&&null!=t.ref?(g.dest_x=t.x,g.dest_y=t.y,new m(r,t,g).redraw()):n!=i&&null!=t.ref||document.getElementById(g.uuid).remove()),x=""}}),this.svg.addEventListener("mousemove",this.events.mouseMoveCb),this.svg.addEventListener("mouseup",this.events.mouseUpCb)}createComponent(t,s){return new e(t,s,this.svg,this.events,this.config)}createRectangle(t=0,s=0,e=10,i=10){return new a(p.generate(),t,s,e,i,this.svg,this.events,this.config)}createLozenge(t=0,s=0,e=10,i=10){return new d(p.generate(),t,s,e,i,this.svg,this.events,this.config)}createTriangle(t=0,s=0,e=5,i=5,h=10,n=10){return new o(p.generate(),t,s,e,i,h,n,this.svg,this.events,this.config)}createCircle(t=0,s=0,e){return new r(p.generate(),t,s,this.svg,this.events,this.config)}createText(t=0,s=0,e="text"){return new h(p.generate(),t,s,e,this.svg,this.events,this.config)}createLine(t=0,s=0,e=t,i=s){return new w(p.generate(),t,s,e,i,this.svg,this.events,this.config)}createPolyline(t=[]){return new f(p.generate(),t,this.svg,this.events,this.config)}createPoint(t=0,s=0,e=5){return new c(p.generate(),t,s,e,this.svg,this.events,this.config)}createArc(t=0,s=0,e=100,i=100,h=90){return new v(p.generate(),t,s,e,i,h,this.svg,this,this.events,this.config)}createGroup(){return new n(p.generate(),this.svg,this.events,this.config)}},Object.defineProperty(t,"__esModule",{value:!0})});