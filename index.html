<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="initial-scale=1.0">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" 
   rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" 
   crossorigin="anonymous">
   <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" 
   integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" 
   integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
   <link rel="stylesheet" href="style.css">
   <script src="./build/aya.js"></script>
   <title>Document</title>
</head>

<body>
   <script>
      var svg;
      console.log(aya);
      svg = document.createElementNS("http://www.w3.org/2000/svg", 'svg');
      svg.setAttribute("width", 1300);
      svg.setAttribute("height", 600);
      svg.setAttribute("id", "svg");

      svg.addEventListener("mousemove", aya.events.mouseMoveCb);
      svg.addEventListener("mouseup", aya.events.mouseUpCb);

      aya.config.line = undefined;

      var nbCol = 20, nbLine = 20;
      var tail_px = 20;
      var k;
      var state = true;



      var vie = [];
      var tmp = [];

      var nbr = 60;
      var i_nbre = 0;

      var box = new aya.Component("rectangle", {
            x: 500,
            y: 100,
            height: nbLine * tail_px,
            width: nbCol * tail_px
      });


      function live(){
         for(var i = 0; i < nbLine * nbCol ; i++){
            if( i_nbre < nbr){
               if(Math.random() < 1/6){
                  var pt = new aya.Component("circle", {
                     x: box.form.x + ((Math.floor(i / nbLine)) * tail_px) + Math.floor( tail_px/2), 
                     y: box.form.y + (Math.floor((i % nbCol)) * tail_px) + Math.floor( tail_px/2),
                     r:  Math.floor(tail_px/3)
                  });
                  vie[i] = pt;
                  // console.log(vie[i]);
                  i_nbre++;
               }
               else{
                  vie[i] = 0;
                  console.log(vie[i]);
               }
            }
            else{
               vie[i] = 0;
               tmp[i] = 0;
            }
         }
      }

      function applied(){
         
      }
      
      function grille(nbLine, nbCol){
         for(var j = 1; j <= nbLine - 1; j++){
            
            var line = new aya.Line(aya._uuid.generate(), 0, j * tail_px, nbLine*tail_px, j * tail_px);
            box.form.addChild(line, (p, c)=> {
            }, (p,c)=>{
            })
         }


         for(var j = 1; j <= nbCol - 1; j++){
            var line = new aya.Line(aya._uuid.generate(), j * tail_px, 0, tail_px*j, nbCol * tail_px);
            box.form.addChild(line, (p, c)=> {
            },  (p,c)=>{
            })
         }
         live();
      }

      
      grille(nbLine,nbLine);


      function generation(vie, tmp){
         var cpt=0, i, j, k, p;
  
         for(i = 0; i < nbLine; i++)
            for(j = 0; j < nbCol; j++)
               tmp[i*nbCol+j] = vie[i*nbCol+j];
  
          for(i = 0; i < nbLine; i++){
            for(j = 0; j < nbCol; j++){
               for(k = i-1; k < i+2; k++){
                  if( k < 0 || k > 2 )
                     continue;
                  for(p = j-1; p < j+2; p++){
                     if(p < 0 || p > 2 || (k==i && p==j))
                        continue;
                  if(vie[k*nbCol+p] != 0)
                     cpt++;
                  }
               }
               if(vie[i*nbCol+j] == 0 && cpt == 3){
                  var pt = new aya.Component("circle", {
                     x: box.form.x + ((Math.floor(i)) * tail_px) + Math.floor( tail_px/2), 
                     y: box.form.y + (Math.floor((j)) * tail_px) + Math.floor( tail_px/2),
                     r:  Math.floor(tail_px/3)
                  });
                  console.log("dans le if");
                  console.log(pt);
                  tmp[i*nbCol+j] = pt;
               }
               if(vie[i*nbCol+j] != 0 && cpt != 3 && cpt != 2)
                  tmp[i*nbCol+j] = 0;
               cpt = 0;
            }

            console.log(tmp);
         }
  
  
         for(i = 0; i < nbLine; i++)
            for(j = 0; j < nbCol; j++)
               vie[i*nbCol+j] = tmp[i*nbCol+j];
      }


      console.log(vie);
      console.log(tmp);


      function play(){
         var i = 0;
         while(i < 50){
            generation(vie, tmp);
            i++;
         }
      }
      document.body.append(svg);
   </script>

</body>

<div class="jeu">
   <button type="button" class="btn btn-primary" id="but" onclick="play()">Play</button>
</div>

</html>