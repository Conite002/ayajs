<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="initial-scale=1.0">
   <link rel="stylesheet" href="style.css">
   <script src="./build/aya.js"></script>
   <title>ayajs</title>
</head>

<body>

   <script>
      var aya = new aya.Application();
      console.log(aya);

      function ressource(){
         
         var dx = 300, dy = 100, r = 5, width = 40, height = 20;

         // node root
         var noeud = aya.Circle(dx, dy, r);
         noeud.draw();

         noeud.vertex.map( (vt) => vt.removeFromDOM());
         noeud.c_points.map( (cp) => cp.removeFromDOM());

         var path = aya.Text(dx + 10, dy -5 , "foo");
         path.draw();


         var line = aya.Polyline([dx + r, dy, dx+r+100, dy]);
         line.draw();

         var box = aya.Lozenge(dx+r+100 + 50/2, dy - 50/2, 50, 50);
         box.draw();
         box.vertex.map( (vt) => vt.removeFromDOM());
         box.c_points.map( (cp) => cp.removeFromDOM());

         var arc = aya.Polyline([dx+r+100+50/2, dy - 50/2, dx+r+100+50/2, dy - 50/2 - 25, dx+r+100+50/2 + 70, dy - 50/2 -25] );
         arc.draw();
         arc.c_svg.setAttribute("fill", "none");

         var verb = aya.Component("rectangle",{x : dx+r+100+50/2 + 15, y : dy - 50/2 - 25 - height - 5, width: width, height: height});
         verb.form.c_svg.setAttributeNS(null, "stroke", "white");


         verb.form.vertex.map( (vt) => vt.removeFromDOM());
         verb.form.c_points.map( (cp) => cp.removeFromDOM());
         var text_verb = aya.Text(0,0, "get");

         verb.form.addChild(text_verb, (p,c) => {
            c.setOffsetX(p.x + 2);
            c.setOffsetY(p.y + p.height/2);
         }, (p, c) => {

         });

         var method = aya.Rectangle( dx+r+100+50/2 + 70, dy - 50/2 -25 - height/2, width, height);
         method.draw();
         method.vertex.map( (vt) => vt.removeFromDOM());
         method.c_points.map( (cp) => cp.removeFromDOM());


         /*********************************************************************************************/

         var dx2 = dx + 50/2, dy2 = dy + 100;

         // node root
         var noeud2 = aya.Circle(dx2, dy2, r);
         noeud2.draw();

         noeud2.vertex.map( (vt) => vt.removeFromDOM());
         noeud2.c_points.map( (cp) => cp.removeFromDOM());

         var path = aya.Text(dx2 + 10, dy2 - 5 , "{id}");
         path.draw();


         var link = aya.Polyline([dx, dy+5, dx2, dy2-5]);
         link.draw();



         var line = aya.Polyline([dx2 + r, dy2, dx2+r+100, dy2]);
         line.draw();

         var box = aya.Lozenge(dx2+r+100 + 50/2, dy2 - 50/2, 50, 50);
         box.draw();
         box.vertex.map( (vt) => vt.removeFromDOM());
         box.c_points.map( (cp) => cp.removeFromDOM());

         var arc = aya.Polyline([dx2+r+100+50/2, dy2 - 50/2, dx2+r+100+50/2, dy2 - 50/2 - 25, dx2+r+100+50/2 + 70, dy2 - 50/2 -25] );
         arc.draw();
         arc.c_svg.setAttribute("fill", "none");

         var verb = aya.Component("rectangle",{x : dx2+r+100+50/2 + 15, y : dy2 - 50/2 - 25 - height - 5, width: width, height: height});
         verb.form.c_svg.setAttributeNS(null, "stroke", "white");


         verb.form.vertex.map( (vt) => vt.removeFromDOM());
         verb.form.c_points.map( (cp) => cp.removeFromDOM());
         var text_verb = aya.Text(0,0, "put");

         verb.form.addChild(text_verb, (p,c) => {
            c.setOffsetX(p.x + 2);
            c.setOffsetY(p.y + p.height/2);
         }, (p, c) => {

         });

         var method = aya.Rectangle( dx2+r+100+50/2 + 70, dy2 - 50/2 -25 - height/2, width, height);
         method.draw();
         method.vertex.map( (vt) => vt.removeFromDOM());
         method.c_points.map( (cp) => cp.removeFromDOM());

         /***********************************************************************************************/

         var dx3 = dx2 + 50/2, dy3 = dy2 + 100;

         // node root
         var noeud2 = aya.Circle(dx3, dy3, r);
         noeud2.draw();

         noeud2.vertex.map( (vt) => vt.removeFromDOM());
         noeud2.c_points.map( (cp) => cp.removeFromDOM());

         var path = aya.Text(dx3 + 10, dy3 - 5 , "bar");
         path.draw();


         var link = aya.Polyline([dx2, dy2+5, dx3, dy3-5]);
         link.draw();



         var line = aya.Polyline([dx3 + r, dy3, dx3+r+100, dy3]);
         line.draw();

         var box = aya.Lozenge(dx3+r+100 + 50/2, dy3 - 50/2, 50, 50);
         box.draw();
         box.vertex.map( (vt) => vt.removeFromDOM());
         box.c_points.map( (cp) => cp.removeFromDOM());

         var arc = aya.Polyline([dx3+r+100+50/2, dy3 - 50/2, dx3+r+100+50/2, dy3 - 50/2 - 25, dx3+r+100+50/2 + 70, dy3 - 50/2 -25] );
         arc.draw();
         arc.c_svg.setAttribute("fill", "none");

         var verb = aya.Component("rectangle",{x : dx3+r+100+50/2 + 15, y : dy3 - 50/2 - 25 - height - 5, width: width, height: height});
         verb.form.c_svg.setAttributeNS(null, "stroke", "white");


         verb.form.vertex.map( (vt) => vt.removeFromDOM());
         verb.form.c_points.map( (cp) => cp.removeFromDOM());
         var text_verb = aya.Text(0,0, "post");

         verb.form.addChild(text_verb, (p,c) => {
            c.setOffsetX(p.x + 2);
            c.setOffsetY(p.y + p.height/2);
         }, (p, c) => {

         });

         var method = aya.Rectangle( dx3+r+100+50/2 + 70, dy3 - 50/2 -25 - height/2, width, height);
         method.draw();
         method.vertex.map( (vt) => vt.removeFromDOM());
         method.c_points.map( (cp) => cp.removeFromDOM());

         /*******************************************************************************/


         var dx4 = dx3 + 50/2, dy4 = dy3 + 100;

         // node root
         var noeud2 = aya.Circle(dx4 - 25, dy4, r);
         noeud2.draw();

         noeud2.vertex.map( (vt) => vt.removeFromDOM());
         noeud2.c_points.map( (cp) => cp.removeFromDOM());

         var path = aya.Text(dx4 + 10, dy4 - 5 , "bar");
         path.draw();


         var link = aya.Polyline([dx2, dy2+5, dx4 - 25, dy4-5]);
         link.draw();



         var line = aya.Polyline([dx4 + r - 25, dy4, dx4+r+100, dy4]);
         line.draw();

         var box = aya.Lozenge(dx4+r+100 + 50/2, dy4 - 50/2, 50, 50);
         box.draw();
         box.vertex.map( (vt) => vt.removeFromDOM());
         box.c_points.map( (cp) => cp.removeFromDOM());

         var arc = aya.Polyline([dx4+r+100+50/2, dy4 - 50/2, dx4+r+100+50/2, dy4 - 50/2 - 25, dx4+r+100+50/2 + 70, dy4 - 50/2 -25] );
         arc.draw();
         arc.c_svg.setAttribute("fill", "none");

         var verb = aya.Component("rectangle",{x : dx4+r+100+50/2 + 15, y : dy4 - 50/2 - 25 - height - 5, width: width, height: height});
         verb.form.c_svg.setAttributeNS(null, "stroke", "white");


         verb.form.vertex.map( (vt) => vt.removeFromDOM());
         verb.form.c_points.map( (cp) => cp.removeFromDOM());
         var text_verb = aya.Text(0,0, "patch");

         verb.form.addChild(text_verb, (p,c) => {
            c.setOffsetX(p.x + 2);
            c.setOffsetY(p.y + p.height/2);
         }, (p, c) => {

         });

         var method = aya.Rectangle( dx4+r+100+50/2 + 70, dy4 - 50/2 -25 - height/2, width, height);
         method.draw();
         method.vertex.map( (vt) => vt.removeFromDOM());
         method.c_points.map( (cp) => cp.removeFromDOM());


         /*******************************************************************************/


         var dx5 = dx4 + 50/2, dy5 = dy4 + 100;

         // node root
         var noeud2 = aya.Circle(dx5 - 75, dy5, r);
         noeud2.draw();

         noeud2.vertex.map( (vt) => vt.removeFromDOM());
         noeud2.c_points.map( (cp) => cp.removeFromDOM());

         var path = aya.Text(dx5 + 10, dy5 - 5 , "bar");
         path.draw();


         var link = aya.Polyline([dx, dy+5, dx5 - 75, dy5-5]);
         link.draw();



         var line = aya.Polyline([dx5 + r - 75, dy5, dx5+r+100, dy5]);
         line.draw();

         var box = aya.Lozenge(dx5+r+100 + 50/2, dy5 - 50/2, 50, 50);
         box.draw();
         box.vertex.map( (vt) => vt.removeFromDOM());
         box.c_points.map( (cp) => cp.removeFromDOM());

         var arc = aya.Polyline([dx5+r+100+50/2, dy5 - 50/2, dx5+r+100+50/2, dy5 - 50/2 - 25, dx5+r+100+50/2 + 70, dy5 - 50/2 -25] );
         arc.draw();
         arc.c_svg.setAttribute("fill", "none");

         var verb = aya.Component("rectangle",{x : dx5+r+100+50/2 + 15, y : dy5 - 50/2 - 25 - height - 5, width: width, height: height});
         verb.form.c_svg.setAttributeNS(null, "stroke", "white");


         verb.form.vertex.map( (vt) => vt.removeFromDOM());
         verb.form.c_points.map( (cp) => cp.removeFromDOM());
         var text_verb = aya.Text(0,0, "patch");

         verb.form.addChild(text_verb, (p,c) => {
            c.setOffsetX(p.x + 2);
            c.setOffsetY(p.y + p.height/2);
         }, (p, c) => {

         });

         var method = aya.Rectangle( dx5+r+100+50/2 + 70, dy5 - 50/2 -25 - height/2, width, height);
         method.draw();
         method.vertex.map( (vt) => vt.removeFromDOM());
         method.c_points.map( (cp) => cp.removeFromDOM());




         /*******************************************************************************/


         var dx6 = dx5 + 50/2, dy6 = dy5 + 100;

         // node root
         var noeud2 = aya.Circle(dx6 - 100, dy6, r);
         noeud2.draw();

         noeud2.vertex.map( (vt) => vt.removeFromDOM());
         noeud2.c_points.map( (cp) => cp.removeFromDOM());

         var path = aya.Text(dx6 + 10, dy6 - 5 , "bar");
         path.draw();


         var link = aya.Polyline([dx, dy+5, dx6 - 100, dy6-5]);
         link.draw();



         var line = aya.Polyline([dx6 + r - 100, dy6, dx6+r+100, dy6]);
         line.draw();

         var box = aya.Lozenge(dx6+r+100 + 50/2, dy6 - 50/2, 50, 50);
         box.draw();
         box.vertex.map( (vt) => vt.removeFromDOM());
         box.c_points.map( (cp) => cp.removeFromDOM());

         var arc = aya.Polyline([dx6+r+100+50/2, dy6 - 50/2, dx6+r+100+50/2, dy6 - 50/2 - 25, dx6+r+100+50/2 + 70, dy6 - 50/2 -25] );
         arc.draw();
         arc.c_svg.setAttribute("fill", "none");

         var verb = aya.Component("rectangle",{x : dx6+r+100+50/2 + 15, y : dy6 - 50/2 - 25 - height - 5, width: width, height: height});
         verb.form.c_svg.setAttributeNS(null, "stroke", "white");


         verb.form.vertex.map( (vt) => vt.removeFromDOM());
         verb.form.c_points.map( (cp) => cp.removeFromDOM());
         var text_verb = aya.Text(0,0, "patch");

         verb.form.addChild(text_verb, (p,c) => {
            c.setOffsetX(p.x + 2);
            c.setOffsetY(p.y + p.height/2);
         }, (p, c) => {

         });

         var method = aya.Rectangle( dx6+r+100+50/2 + 70, dy6 - 50/2 -25 - height/2, width, height);
         method.draw();
         method.vertex.map( (vt) => vt.removeFromDOM());
         method.c_points.map( (cp) => cp.removeFromDOM());


      }
     

      function task(){
         var arc_store = [];
         var arrow = aya.Component("line", {x: 100, y: 300, dest_x: 300, dest_y: 300});


         var arc1 = aya.Arc(300 + 30 +10, 300, 300 + 30 +10 - 35 ,300 + 25, 40);
         arc1.draw();

         var line1 = aya.Line(arc1.x0, arc1.y0, arc1.x, arc1.y);
         line1.draw();
         line1.children.map(({child}) => {
            child.removeFromDOM();
         });

         arc_store.push({arc: arc1, line : line1});


         var arc2 = aya.Arc(300 + 30 +10, 300, arc1.dest_x ,arc1.dest_y , 40);
         arc2.draw();

         var line1 = aya.Line(arc2.x0 , arc2.y0 + 30, arc2.x, arc2.y);
         line1.draw();
         line1.children.map(({child}) => {
            child.removeFromDOM();
         });

         arc_store.push({arc: arc2, line : line1});


         var arc3 = aya.Arc(300 + 30 +10, 300, arc2.dest_x  ,arc2.dest_y, 40);
         arc3.draw();

         var line1 = aya.Line(arc3.x0, arc3.y0, arc3.x, arc3.y);
         line1.draw();
         line1.children.map(({child}) => {
            child.removeFromDOM();
         });

         arc_store.push({arc: arc3, line : line1});


         var arc4 = aya.Arc(300 + 30 +10, 300, arc3.dest_x ,arc3.dest_y , 40);
         arc4.draw();

         var line1 = aya.Line(arc4.x0, arc4.y0, arc4.x, arc4.y);
         line1.draw();
         line1.children.map(({child}) => {
            child.removeFromDOM();
         });

         var end_line = aya.Line(arc4.x0, arc4.y0, arc4.dest_x, arc4.dest_y);
         end_line.draw();
         end_line.children.map(({child}) => {
            child.removeFromDOM();
         });

         arc_store.push({arc: arc4, line : line1});


         var circle = aya.Circle(0, 0,30);

         arrow.form.addChild(circle, (p,c) => {
            c.setOffsetX(p.dest_x + 30 + 10);
            c.setOffsetY(p.dest_y)
         }, (p,c) =>{});


         arc_store.map( ({arc, line}) => {
            arc.removeFromDOM();
            line.removeFromDOM();
         });
         end_line.removeFromDOM();

         circle.addEvent("mouseover", () => {
            arc_store.map( ({arc, line}) => {
               arc.draw();
               line.draw();
            });
            end_line.draw();
         });

         circle.addEvent("mouseleave", () => {
            arc_store.map( ({arc, line}) => {
               arc.removeFromDOM();
               line.removeFromDOM();
            });
            end_line.removeFromDOM();
         });
      }


      var res = aya.Ressource(200,100, 50);
      res.draw();
      res.removeBoxFromDOM();


      document.body.append(aya.svg);
   </script>

</body>

</html>