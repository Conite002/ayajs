<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="initial-scale=1.0">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" 
   rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" 
   crossorigin="anonymous">
   <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" 
   integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" 
   integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
   <link rel="stylesheet" href="style.css">
   <script src="./build/aya.js"></script>
   <title>Document</title>
</head>

<body>
   <script>
      var svg;
      var ns="http://www.w3.org/2000/svg";
      var n="http://www.w3.org/2000/svg";
      var vie = [];
      var tmp = [];
      var children = [];
      console.log(aya);
      svg = document.createElementNS("http://www.w3.org/2000/svg", 'svg');
      svg.setAttribute("width", 1300);
      svg.setAttribute("height", 600);
      svg.setAttribute("id", "svg");

      svg.addEventListener("mousemove", aya.events.mouseMoveCb);
      svg.addEventListener("mouseup", aya.events.mouseUpCb);

      aya.config.line = undefined;

      var nbCol = 20, nbLine = 20;
      var tail_px = 20;
      var state = true;




var nbr = 3;
var i_nbre = 0;

var box = new aya.Component("rectangle", {
      x: 500,
      y: 100,
      height: nbLine * tail_px,
      width: nbCol * tail_px
});


function init(){

   for(var i = 0; i < nbLine;i++ ){
      for(var j = 0; j < nbCol; j++){
         k = i * nbLine + j ;

      if( i_nbre < nbr && i > 5 && j > 5){
         // if(Math.random() < 1/6 ){
            vie[k] = 1;
            vie[k++] = 1;
            vie[k++] = 1;
            i_nbre++;
      //    }
      //    else{
      //       vie[k] = 0;
      //       // console.log(vie[i]);
      //    }
      }
      else{
         vie[k] = 0;
         tmp[k] = 0;
      }

      }
   }
}

function applied(){

   var child = [];
   for(var i = 0; i < nbLine;i++ ){
      for(var j = 0; j < nbCol; j++){
         k = i * nbLine + j ;
         if(vie[k] == 1){
            var pt = new aya.Circle(aya._uuid.generate(), (i * tail_px), (j * tail_px), Math.floor(tail_px/2));
            pt.setOffsetX(box.form.x + Math.floor( tail_px/2));
            pt.setOffsetY(box.form.y  + Math.floor( tail_px/2));
            pt.draw(svg);
            child.push(pt);
         }
      }
   }
   children = [...child];
}

function grille(nbLine, nbCol){
   for(var j = 1; j <= nbLine - 1; j++){
      
      var line = new aya.Line(aya._uuid.generate(), 0, j * tail_px, nbLine*tail_px, j * tail_px);
      box.form.addChild(line, (p, c)=> {
      }, (p,c)=>{
      })
   }


   for(var j = 1; j <= nbCol - 1; j++){
      var line = new aya.Line(aya._uuid.generate(), j * tail_px, 0, tail_px*j, nbCol * tail_px);
      box.form.addChild(line, (p, c)=> {
      },  (p,c)=>{
      })
   }
}


function generation(){

   var temp = [], cpt=0, i, j, k, p;
   var l = nbLine, c = nbCol;
   var tmp = [...vie];
   temp = [...vie];

   for(i = 0; i < l; i++){
      for(j = 0; j < c; j++){
         for(k = i-1; k < i+2; k++){
            if( k < 0 || k > c-1 )
               continue;
            for(p = j-1; p < j+2; p++){
               if(p < 0 || p > c - 1 || (k==i && p==j))
                  continue;
               if(tmp[k*c+p] == 1){
                  cpt++;

               }
            }
         }
         if(tmp[i*c+j] == 0 && cpt == 3){
            temp[i*c+j] = 1;

         }
         if(tmp[i*c+j] == 1 && cpt != 3 && cpt != 2)
            temp[i*c+j] = 0;
         cpt = 0;
      }
   }

   for(i = 0; i < l; i++)
      for(j = 0; j < c; j++)
         vie[i*c+j] = temp[i*c+j];

}

function play(){
  var i = 0;

  while(i < 3 ){
      children.map( (chd) => {
         var ch = document.getElementsByTagNameNS(n, 'circle');
         chd.remove();
      });
      children = [...[]];
      generation();
      applied();
      i++;
  }
}

grille(nbLine,nbLine);
init();
applied();
document.body.append(svg);
</script>

</body>

<div class="jeu">
   <button type="button" class="btn btn-primary" id="but" onclick="play()">Play</button>
</div>

</html>